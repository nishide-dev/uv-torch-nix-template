# Copier template configuration for uv-torch-nix-template
# This is an extension template that adds PyTorch/CUDA support to uv-nix-template

_min_copier_version: "9.0.0"

# ============================================================================
# User questions - ProjectåŸºæœ¬æƒ…å ±
# ============================================================================

project_name:
  type: str
  help: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (Enterã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã‚’ä½¿ç”¨)"
  default: "{{ _copier_conf.dst_path.name }}"

package_name:
  type: str
  help: "ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (Pythonã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆåã€é€šå¸¸ã¯ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹)"
  default: "{{ project_name | replace('-', '_') }}"

description:
  type: str
  help: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®çŸ­ã„èª¬æ˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
  default: "A PyTorch/CUDA deep learning project"

author_name:
  type: str
  help: "ä½œè€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
  default: "Your Name"

author_email:
  type: str
  help: "ä½œè€…ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
  default: "your.email@example.com"

python_version:
  type: str
  help: "å¯¾è±¡ã¨ã™ã‚‹æœ€å°Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„"
  default: "3.12"
  choices:
    - "3.10"
    - "3.11"
    - "3.12"
    - "3.13"

# ============================================================================
# User questions - é–‹ç™ºãƒ„ãƒ¼ãƒ«è¨­å®š
# ============================================================================

use_ruff:
  type: bool
  help: "Ruff (é«˜é€Ÿlinter/formatter) ã‚’ä½¿ç”¨ã—ã¾ã™ã‹ï¼Ÿ"
  default: true

use_ty:
  type: bool
  help: "ty (é«˜é€Ÿå‹ãƒã‚§ãƒƒã‚«ãƒ¼ by Astral) ã‚’ä½¿ç”¨ã—ã¾ã™ã‹ï¼Ÿ"
  default: true

use_pytest:
  type: bool
  help: "Pytest (ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯) ã‚’ä½¿ç”¨ã—ã¾ã™ã‹ï¼Ÿ"
  default: true

use_mypy:
  type: bool
  help: "mypy (å‹ãƒã‚§ãƒƒã‚«ãƒ¼) ã‚’ä½¿ç”¨ã—ã¾ã™ã‹ï¼Ÿ"
  default: false

use_github_actions:
  type: bool
  help: "GitHub Actions CI/CDã‚’è¨­å®šã—ã¾ã™ã‹ï¼Ÿ"
  default: true

use_nix:
  type: bool
  help: "Nix + direnv ã«ã‚ˆã‚‹é–‹ç™ºç’°å¢ƒç®¡ç†ã‚’ä½¿ç”¨ã—ã¾ã™ã‹ï¼Ÿ"
  default: true

# ============================================================================
# User questions - PyTorch/CUDA configuration
# ============================================================================
#
# ã€CUDA/PyTorchãƒãƒ¼ã‚¸ãƒ§ãƒ³å¯¾å¿œè¡¨ã€‘
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ PyTorch     â”‚ CUDA        â”‚ cuDNN        â”‚ æ¨å¥¨ç’°å¢ƒ            â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚ 2.5.1       â”‚ 12.4, 12.1  â”‚ 9.1.0        â”‚ RTX 40xx (Ada)      â”‚
# â”‚ 2.4.1       â”‚ 12.1, 11.8  â”‚ 8.9.7        â”‚ RTX 30xx (Ampere)   â”‚
# â”‚ 2.3.1       â”‚ 12.1, 11.8  â”‚ 8.9.2        â”‚ RTX 30xx (Ampere)   â”‚
# â”‚ 2.2.2       â”‚ 12.1, 11.8  â”‚ 8.9.2        â”‚ æ±ç”¨                â”‚
# â”‚ 2.1.2       â”‚ 12.1, 11.8  â”‚ 8.9.2        â”‚ å¤ã„GPUå¯¾å¿œ         â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
# ã€æ³¨æ„äº‹é …ã€‘
# - NixOSä¸Šã§ä½¿ç”¨ã™ã‚‹å ´åˆã¯ docs/NIX_SETUP.md ã‚’å¿…ãšå‚ç…§ã—ã¦ãã ã•ã„
# - nixpkgsã§åˆ©ç”¨å¯èƒ½ãªCUDAãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯é™ã‚‰ã‚Œã¦ã„ã¾ã™ï¼ˆ11.8, 12.1ç­‰ï¼‰
# - CUDA 12.4ä»¥é™ã¯ nixpkgs ã®å¯¾å¿œçŠ¶æ³ã‚’ç¢ºèªã—ã¦ãã ã•ã„
# - GPUã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«å¿œã˜ã¦é©åˆ‡ãªCUDAãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„
#
# è©³ç´°: https://pytorch.org/get-started/locally/
# ============================================================================

pytorch_version:
  type: str
  help: "PyTorchãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: 2.5.1, 2.4.1, 2.3.1ï¼‰"
  default: "2.5.1"

cuda_version:
  type: str
  help: "CUDAãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: 12.4, 12.1, 11.8ï¼‰ï½œNixOS: docs/NIX_SETUP.mdå‚ç…§"
  default: "12.4"

cudnn_version:
  type: str
  help: "cuDNNãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: 9.1.0, 8.9.7ï¼‰"
  default: "9.1.0"

pytorch_cuda_arch:
  type: str
  help: "PyTorch CUDA architectureã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆcu124, cu121, cu118ãªã©ã€‚ç©ºç™½ã®å ´åˆã¯cuda_versionã‹ã‚‰è‡ªå‹•ç”Ÿæˆï¼‰"
  default: ""

use_torchvision:
  type: bool
  help: "torchvisionã‚’å«ã‚ã¾ã™ã‹ï¼Ÿ"
  default: true

use_torchaudio:
  type: bool
  help: "torchaudioã‚’å«ã‚ã¾ã™ã‹ï¼Ÿ"
  default: false

additional_cuda_libs:
  type: str
  help: "è¿½åŠ ã®CUDAãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã€ä¾‹: nccl,cutlass,libcusparseï¼‰ï½œåˆ†æ•£å­¦ç¿’ã‚„ã‚¹ãƒ‘ãƒ¼ã‚¹æ¼”ç®—ã«å¿…è¦"
  default: ""

# ============================================================================
# File/directory exclusion settings
# ============================================================================

_exclude:
  - "copier.yml"
  - "copier.yaml"
  - ".git"
  - ".venv"
  - "__pycache__"
  - "*.pyc"
  - ".pytest_cache"
  - ".mypy_cache"
  - ".ruff_cache"
  - "uv.lock"
  - "dist"
  - "build"
  - "*.egg-info"
  - "{% if not use_ruff %}ruff.toml.jinja{% endif %}"  # Ruffæœªä½¿ç”¨ã®å ´åˆã¯é™¤å¤–
  - "{% if not use_nix %}flake.nix.jinja{% endif %}"  # Nixæœªä½¿ç”¨ã®å ´åˆã¯é™¤å¤–
  - "{% if not use_nix %}.envrc{% endif %}"  # Nixæœªä½¿ç”¨ã®å ´åˆã¯é™¤å¤–
  - "{% if not use_nix %}docs{% endif %}"  # Nixæœªä½¿ç”¨ã®å ´åˆã¯docsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå…¨ä½“ã‚’é™¤å¤–
  - "{% if not use_github_actions %}.github{% endif %}"  # GitHub Actionsæœªä½¿ç”¨ã®å ´åˆã¯é™¤å¤–

# ============================================================================
# Post-generation tasks
# ============================================================================

_tasks:
  - |
    echo ""
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "ğŸ‰ PyTorch/CUDA Development Environment Created!"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""
    echo "ğŸ“¦ Project: {{ project_name }}"
    echo "ğŸ“ Package: {{ package_name }}"
    echo ""
    echo "ğŸ”¥ GPU/CUDA Configuration:"
    echo "   â€¢ PyTorch:    {{ pytorch_version }}"
    echo "   â€¢ CUDA:       {{ cuda_version }}"
    echo "   â€¢ cuDNN:      {{ cudnn_version }}"
    {% if use_torchvision %}echo "   â€¢ torchvision: Enabled"{% endif %}
    {% if use_torchaudio %}echo "   â€¢ torchaudio:  Enabled"{% endif %}
    echo ""
    echo "ğŸ Python Environment:"
    echo "   â€¢ Python:     {{ python_version }}+"
    {% if use_ruff %}echo "   â€¢ Ruff:       Enabled (linter/formatter)"{% endif %}
    {% if use_ty %}echo "   â€¢ ty:         Enabled (type checker)"{% endif %}
    {% if use_mypy %}echo "   â€¢ mypy:       Enabled (type checker)"{% endif %}
    {% if use_pytest %}echo "   â€¢ Pytest:     Enabled (test framework)"{% endif %}
    echo ""
    {% if use_nix %}
    echo "âš ï¸  IMPORTANT: NixOS Users"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "Before proceeding, you MUST configure your system:"
    echo ""
    echo "1. Edit /etc/nixos/configuration.nix to enable:"
    echo "   â€¢ NVIDIA drivers (services.xserver.videoDrivers)"
    echo "   â€¢ hardware.opengl.enable = true"
    echo "   â€¢ programs.nix-ld.enable = true"
    echo ""
    echo "2. Apply the configuration:"
    echo "   sudo nixos-rebuild switch"
    echo ""
    echo "ğŸ“– See docs/NIX_SETUP.md for detailed instructions"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""
    {% endif %}
    echo "ğŸš€ Next Steps:"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""
    {% if use_nix %}
    echo "1. Activate the Nix environment:"
    echo "   direnv allow"
    echo "   # The environment will auto-activate and show GPU status"
    echo ""
    echo "2. Install dependencies:"
    {% else %}
    echo "1. Create a virtual environment:"
    echo "   uv venv"
    echo "   source .venv/bin/activate  # or .venv\\Scripts\\activate on Windows"
    echo ""
    echo "2. Install dependencies:"
    {% endif %}
    echo "   uv sync"
    echo ""
    echo "3. Verify CUDA availability:"
    echo "   uv run python -c \"import torch; print(f'CUDA available: {torch.cuda.is_available()}')\""
    echo ""
    {% if use_pytest %}
    echo "4. Run tests:"
    echo "   uv run pytest"
    echo ""
    {% endif %}
    echo "ğŸ“š Documentation:"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    {% if use_nix %}
    echo "   â€¢ docs/NIX_SETUP.md   - NixOS-specific setup (REQUIRED)"
    {% endif %}
    echo "   â€¢ docs/CUDA_SETUP.md  - PyTorch/CUDA environment guide"
    echo "   â€¢ README.md           - Project overview and usage"
    echo ""
    echo "ğŸ’¡ Useful Commands:"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "   â€¢ uv add <package>              - Add a dependency"
    echo "   â€¢ uv add --dev <package>        - Add a dev dependency"
    echo "   â€¢ uv add flash-attn --no-build-isolation  - Add packages that need compilation"
    {% if use_pytest %}
    echo "   â€¢ uv run pytest                 - Run tests"
    echo "   â€¢ uv run pytest --cov=src       - Run tests with coverage"
    {% endif %}
    {% if use_ruff %}
    echo "   â€¢ uv run ruff check .           - Lint code"
    echo "   â€¢ uv run ruff format .          - Format code"
    {% endif %}
    {% if use_ty %}
    echo "   â€¢ uv run ty check               - Type check with ty"
    {% endif %}
    {% if use_mypy %}
    echo "   â€¢ uv run mypy src               - Type check with mypy"
    {% endif %}
    echo ""
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "âœ¨ Happy GPU-accelerated deep learning! âœ¨"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""

# ============================================================================
# Template metadata
# ============================================================================

_metadata:
  template_version: "0.1.0"
  base_template: "uv-nix-template"
  description: "PyTorch/CUDA extension for uv-nix-template"
